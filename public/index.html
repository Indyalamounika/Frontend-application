<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AWS Microservices App</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>⚡</text></svg>">
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f4f4f4; }
        hr { margin: 20px 0; }
        input, button { padding: 8px; margin: 5px 0; }
        button { cursor: pointer; background: #007bff; color: white; border: none; border-radius: 4px; }
        button:hover { background: #0056b3; }
        pre { background: #eee; padding: 10px; border-radius: 4px; }
    </style>
</head>
<body>
    <h1>AWS DevOps Microservices Project By Nexgen Team</h1>

    <hr>

    <h2>Register</h2>
    <input type="text" id="regName" placeholder="Name"><br>
    <input type="email" id="regEmail" placeholder="Email"><br>
    <input type="password" id="regPassword" placeholder="Password"><br>
    <button onclick="registerUser()">Register</button>

    <hr>

    <h2>Login</h2>
    <input type="email" id="loginEmail" placeholder="Email"><br>
    <input type="password" id="loginPassword" placeholder="Password"><br>
    <button onclick="loginUser()">Login</button>

    <hr>

    <h2>Other Services</h2>
    <button onclick="loadUsers()">Load Users</button>
    <button onclick="loadOrders()">Load Orders</button>

    <hr>

    <h2>Orders List</h2>
    <button onclick="fetchOrders()">Fetch Orders (alternate)</button>
    <ul id="order-list"></ul>

    <hr>

    <pre id="result">Results will appear here...</pre>

    <script>
        // Base URLs – change these if your services are deployed elsewhere
        const USER_SERVICE_URL = 'http://localhost:4000';
        const ORDER_SERVICE_URL = 'http://localhost:5002';

        // Helper to display results
        function displayResult(data) {
            document.getElementById('result').textContent = JSON.stringify(data, null, 2);
        }

        // Register
        async function registerUser() {
            const name = document.getElementById('regName').value;
            const email = document.getElementById('regEmail').value;
            const password = document.getElementById('regPassword').value;

            if (!name || !email || !password) {
                alert('All fields required');
                return;
            }

            try {
                const res = await fetch(`${USER_SERVICE_URL}/register`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, email, password })
                });
                const data = await res.json();
                displayResult(data);
                if (res.ok) alert('Registration successful');
            } catch (err) {
                displayResult({ error: err.message });
            }
        }

        // Login
        async function loginUser() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            if (!email || !password) {
                alert('Email and password required');
                return;
            }

            try {
                const res = await fetch(`${USER_SERVICE_URL}/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });
                const data = await res.json();
                displayResult(data);
                if (res.ok) {
                    alert('Login successful');
                    // Optionally save token in localStorage
                    // localStorage.setItem('token', data.token);
                }
            } catch (err) {
                displayResult({ error: err.message });
            }
        }

        // Load users (requires no auth for demo)
        async function loadUsers() {
            try {
                const res = await fetch(`${USER_SERVICE_URL}/users`);
                const data = await res.json();
                displayResult(data);
            } catch (err) {
                displayResult({ error: err.message });
            }
        }

        // Load orders (from order service)
        async function loadOrders() {
            try {
                const res = await fetch(`${ORDER_SERVICE_URL}/orders`);
                const data = await res.json();
                displayResult(data);
                // Also update the order list if you want
                const list = document.getElementById('order-list');
                if (Array.isArray(data)) {
                    list.innerHTML = data.map(o => `<li>${o.product_name} - $${o.price} (Status: ${o.status})</li>`).join('');
                } else {
                    list.innerHTML = '<li>No orders or error</li>';
                }
            } catch (err) {
                displayResult({ error: err.message });
            }
        }

        // Alternative fetchOrders (same as loadOrders, kept for compatibility)
        async function fetchOrders() {
            await loadOrders();
        }
    </script>
</body>
</html>
